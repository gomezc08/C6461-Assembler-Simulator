; Constants and data storage
                         LOC    6                     
000006     000024        Data   20               		; Size of our array
000007     000000        Data   0                		; Counter for input numbers
000010     000000        Data   0                		; Temporary storage
000011     000000        Data   0                		; Current number being processed
000012     000000        Data   0                		; Number to find closest to
000013     000000        Data   0                		; Closest number found
000014     000000        Data   0                		; Current difference
000015     001747        Data   999              		; Minimum difference found
000016     000000        Data   0                		; Start of number array (20 words)

; Store addresses for indirect jumps
000017     000162        Data   114              		; Address of Process routine
000020     000147        Data   103              		; Address of ReadLoop routine
000021     000174        Data   124              		; Address of Search routine
000022     000212        Data   138              		; Address of NextNum routine
000023     000216        Data   142              		; Address of Done routine

; Main program
                         LOC    100                   
000144     002007        LDR    0,0,Count        		; Initialize counter
000145     014000        AIR    0,0              		; Set counter to 0
000146     004007        STR    0,0,Count             

; Read loop - Get 20 numbers
000147     002007        LDR    0,0,Count        		; Load counter
000150     002406        LDR    1,0,Size         		; Load size
000151     164100        TRR    0,1              		; Compare counter to size
000152     146166        JCC    3,0,Process      		; If equal, go to processing (check cc(3))

000153     147000        IN     2,0              		; Get input from keyboard
000154     005011        STR    2,0,Current      		; Store the number

; Store in array
000155     003407        LDR    3,0,Count        		; Get current count
000156     124107        STX    1,Count          		; Store count in index register 1
000157     005116        STR    2,1,Array        		; Store number in array using IX1

; Print the number
000160     003011        LDR    2,0,Current           
000161     151001        OUT    2,1              		; Print to console

; Increment counter
000162     002007        LDR    0,0,Count             
000163     014001        AIR    0,1              		; Add 1 to counter
000164     004007        STR    0,0,Count             
000165     032060        JMA    0,ReadAddr,1     		; Continue reading

; Process - Get target number and find closest
000166     147000        IN     2,0              		; Get target number
000167     005012        STR    2,0,Target       		; Store target
000170     151001        OUT    2,1              		; Echo target number

; Initialize for search
000171     002015        LDR    0,0,MinDiff           
000172     004015        STR    0,0,MinDiff      		; Reset minimum difference
000173     014000        AIR    0,0              		; Clear R0 for counter
000174     004007        STR    0,0,Count             

; Search loop
000175     002007        LDR    0,0,Count        		; Load counter
000176     002406        LDR    1,0,Size         		; Load size
000177     164100        TRR    0,1              		; Compare counter to size
000200     0314224       JCC    3,0,Done         		; If equal, jump to Done (check cc(3))

; Calculate difference
000201     003012        LDR    2,0,Target       		; Load target
000202     003407        LDR    3,0,Count        		; Get current index
000203     124107        STX    1,Count          		; Store count in index register 1
000204     003516        LDR    3,1,Array        		; Load array[count] using IX1

; Find absolute difference
000205     013412        SMR    3,0,Target       		; Subtract target
000206     005414        STR    3,0,Diff         		; Store difference

; Compare with minimum
000207     002415        LDR    1,0,MinDiff           
000210     012414        SMR    1,0,Diff         		; Compare differences
000211     042462        JGE    1,0,NextAddr,1   		; If current >= min, skip (indirect)

; Update minimum and closest
000212     003407        LDR    3,0,Count        		; Get current index
000213     124107        STX    1,Count          		; Store count in index register 1
000214     003516        LDR    3,1,Array        		; Load array[count] using IX1
000215     005413        STR    3,0,Closest      		; Update closest
000216     003414        LDR    3,0,Diff              
000217     005415        STR    3,0,MinDiff      		; Update minimum difference

000220     002007        LDR    0,0,Count        		; Increment counter
000221     014001        AIR    0,1                   
000222     004007        STR    0,0,Count             
000223     032061        JMA    0,SearchAddr,1   		; Continue search (indirect)

; Print results
000224     003012        LDR    2,0,Target       		; Load target
000225     151001        OUT    2,1              		; Print target
000226     003013        LDR    2,0,Closest      		; Load closest
000227     151001        OUT    2,1              		; Print closest number
000230     000000        HLT                     		; Stop program
